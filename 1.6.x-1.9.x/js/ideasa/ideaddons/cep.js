var IdeCepAddon=Class.create({_beforeCallGetFunc:$H({}),_afterClearGetFunc:$H({}),_afterCallGetFunc:$H({}),initialize:function(b,a){this.prefix=b;this.cep=null;this.cepProvider=null;this.url=a},addBeforeCallGetMethod:function(b,a){this._beforeCallGetFunc.set(b,a)},_beforeCallGet:function(){(this._beforeCallGetFunc).each(function(a){(a.value)()})},addAfterClearGetMethod:function(b,a){this._afterClearGetFunc.set(b,a)},_afterClearGet:function(){(this._afterClearGetFunc).each(function(a){(a.value)()})},addAfterCallGetMethod:function(b,a){this._afterCallGetFunc.set(b,a)},_afterCallGet:function(){(this._afterCallGetFunc).each(function(a){(a.value)()})},reset:function(){$(this.prefix+":postcode").setValue("");this._clear();$(this.prefix+":postcode").focus()},get:function(){this._beforeCallGet();this.cep=$(this.prefix+":postcode").getValue();if(!this.cep){this._afterClearGet();return}this._clear();$("loading-mask").show();this.cepProvider=new IdeCepProvider(this.url);var a=this.cepProvider.get(this.cep);this._fill(a);$("loading-mask").hide();this._afterCallGet()},validate:function(){$(this.prefix+":postcode").setValue(this._mccep($(this.prefix+":postcode").getValue()))},_clear:function(){try{$(this.prefix+":street1").setValue("");$(this.prefix+":street2").setValue("");if($(this.prefix+":street3")){$(this.prefix+":street3").setValue("")}if($(this.prefix+":street4")){$(this.prefix+":street4").setValue("")}$(this.prefix+":city").setValue("");$(this.prefix+":region_id").setValue("")}catch(a){}},_fill:function(a){try{$(this.prefix+":street1").setValue(a.endereco);if($(this.prefix+":street4")){$(this.prefix+":street4").setValue(a.bairro)}if($(this.prefix+":city")){$(this.prefix+":city").setValue(a.cidade)}if($(this.prefix+":region_id")){$(this.prefix+":region_id").setValue(a.estado)}if($(this.prefix+":street2")){$(this.prefix+":street2").focus()}}catch(b){$(this.prefix+":street1").focus()}},_mccep:function(a){a=a.replace(/\D/g,"");a=a.replace(/(\d{5})(\d)/,"$1-$2");a=a.replace(/(\d{5})(\d{3})$/,"$1-$2");return a}});var IdeCepProvider=Class.create({initialize:function(a){this.url=a},get:function(b){var a=null;new Ajax.Request(this.url,{parameters:{cep:b},asynchronous:false,onSuccess:function(d){try{if(d.status==200){a=d.responseText.evalJSON()}}catch(c){}}.bind(this)});return a}});